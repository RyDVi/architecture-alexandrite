# Кэширование

## Мотивация
Cейчас страница делает тяжёлые запросы на сортировку и фильтрацию по статусам с высокой частотой обращения к серверным системам, поэтому пользователям долго отображается страница. 

Внедрение кэширование:
- Ускорит первую страницу MES.
- снизить нагрузку от частых опросов статусов партнёрами/клиентами.
- разгрузит хранилище 3D-файлов и просмотры моделей больших объёмов.

## Предлагаемое решение

Следует реализовать оба кэширования, но первым серверное. Пояснение:
- Полный контроль на кэшем
- Разгружаем БД
- Обновление ленты сразу для всех пользователей + необходимость обновления ленты для получения свежих данных
- Клиентскую часть следует больше использовать для изображений / хранения 3D моделей (в дальнейшем) / кэширования ответов через ETag и Cache-Control.

Кэшировать следует следующие данные:
- Ленту заказов (освежать при получении новых заказов).
- Данные по заказу: статус, ссылка на модель, расчётные данные и т.д.
- При использовании генерации превью-изображения модели кэшировать это изображение, но лучше это положить в CDN.

Кэшировать необходимо паттерном Write-Though потому что:
- Данные о заказе будут сразу записываться в кэш для быстрой отдачи операторам (сейчас цеха простаивают).
- При Cache-Aside будет несогласованность и промахи, что недопустимо (необходимо гарантировать получение заказа).
- При Refresh-Ahead будут излишние обновления кэша.


[Диаграмма последовательнсти работы кэша](./sequence-diagram.puml)




<b>Инвалидация кэша</b>

Лучше использовать программную инвалидацию + операции по ключам, потому что операторам нужна свежесть сразу после смены статуса. 

Инвалидация, основанная на запросах, будет излишне обновлять данные, что приведёт к увеличению нагрузки на систему.

Временная инвалидация не подходит, как минимум, потому что заказы не теряют свою актуальность с течением времени. Если заказы будут выполняться вовремя, то и протухать не будут.

Почему не только по ключу вручную: необходимо обрабатывать правильно сообщения. Если этого не делать, то появляется вероятность получения несоответствия данных.