# Задание 1. Планирование: анализ, идентификация проблем и поиск решений
Примечание к выполнению задания: файл с названием "Планирование: анализ, идентификация проблем и поиск решений" создать невозможно, поэтому, по аналогии с предыдущими спринтами, задание было написано в README.md.

## 1. Cуществующие и потенциальные проблемные места
1. Потеря/дублирование событий между CRM / MES / Shop через RabbitMQ.
2. Нет трассировки заказа (где застрял, кто виноват, сколько времени в статусе). Заказ создаётся «по событию из очереди» без подтверждённой доставки.
3. Долгие операции вычисления цены (2–30 мин). MES не справляется из-за чего заказы «висят».
4. Партнёрский API: нет backpressure и квот/лимитов для обработки при всплесках нагрузки; 
5. Дашборд операторов грузит горячие данные напрямую из БД без кэширования, разделения БД на чтение / запись. Вероятно, с тяжёлыми сортировками по новизне из-за чего даже с пагинацией работает медленно.
6. Один инстанс для каждго сервиса / БД, нет горизонтального масштабирования.
7. Возможно, что присутствует несогласованность данных между Shop DB и MES DB.

## 2. Инициативы, которые необходимы для устранения нежелательных ситуаций
1. Сквозная модель событий заказов между всеми сервисами.
2. Сквозная трассировка и наблюдаемость, добавить OpenTelemetry.
3. Отдельная очередь для вычисления цены и масштабирование MES под эти вычисления.
4. backpressure для ограничения нагрузки и веб-хуки для асинронной обработки.
5. Разделить базу данных на чтение / запись, добавить архивирование дял старых заказов, добавить партиционирование базы по дате, индексация БД. Добавить кэширование.
6. Добавить масштабирование и API Gateway с балансировкой нагрузки.
7. Добавить нагрузочное тестирование.
8. Добавить автодеплой.
9. Добавить фича-флаги включения / отключения функциональности, чтобы это не тормозило процесс выкладки функционала.


## 3. Инициативы в порядке приоритета
Наиболее критичные проблемы: проблемы с окончанием заказа, проблемы с оформлением новых заказов, отсутствие масштабируемости. Это сильно бьёт по выручке.

1. Сквозная модель событий заказов между всеми сервисами.
2. Разделить базу данных на чтение / запись, добавить архивирование дял старых заказов, добавить партиционирование базы по дате, индексация БД. Добавить кэширование.
3. Отдельная очередь для вычисления цены и масштабирование MES под эти вычисления.
4. Добавить масштабирование и API Gateway с балансировкой нагрузки.
5. Сквозная трассировка и наблюдаемость, добавить OpenTelemetry.
6. backpressure для ограничения нагрузки и веб-хуки для асинронной обработки.
7. Добавить автодеплой.
8. Добавить фича-флаги включения / отключения функциональности, чтобы это не тормозило процесс выкладки функционала.
9. Добавить нагрузочное тестирование.

### 3.1. Архитектура через полгода
1. Шина с надёжной доставкой: все изменения заказа идут как доменные события через RabbitMQ, заказы идемпотентны.
2. Сквозная наблюдаемость с OpenTelemetry.
3. Отдельная обработка ценообразования.
4. Заказы отображаются без задержек.
5. Отказоустойчивое взаимодействие с партнёрским API.
6. Инфраструктура автоматически масштабируется или хотя бы увеличено количество инстансов приложений и БД.
7. Разработчики чаще выкладывают обновления в прод.

### 3.2. Критичные три пункта из списка в ближайшие полгода
1. Сквозная модель событий заказов между всеми сервисами.
- Устраняет корневую причину пропажи заказов и даёт лучшую управляемость инцидентам. Без этого любые последующие улучшения не гарантируют корректности.
2. Разделить базу данных на чтение / запись, добавить архивирование дял старых заказов, добавить партиционирование базы по дате, индексация БД. Добавить кэширование.
- Разделение и кэширование позволит видеть новые заказы мгновенно. Это также снизит жалобы, что страницы долго грузятся.
3. Отдельная очередь для вычисления цены и масштабирование MES под эти вычисления.
- Решит проблему с 30-минутными расчётами. Это напрямую сократит очередь заказов и время расчётов.

Параллельно можно добавить телеметрию с базовыми метриками, чтобы доказать эффект от инициатив. Это не должно быть сильно затратным.